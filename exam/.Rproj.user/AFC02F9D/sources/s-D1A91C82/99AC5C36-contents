library(networkD3)
library(igraph)
library(curl)
library(dplyr)
setwd("C:\\Users\\Liav\\PycharmProjects\\twitter")

data <- read.csv("connections_adjacency.csv", row.names = 1)
colnames(data) = colnames(data) %>% sub(replacement = "@",pattern = "X.")

matrix=as.matrix(data)


label <- read.csv(curl("https://dl.dropboxusercontent.com/s/erdu802n7bsqk5e/label.csv"), sep=";")
#Importing original labels - page adress

Nodes = as.data.frame(rownames(data))
#Generating nodes object with orderd labels

colnames(Nodes) = "Node"

colnames(Nodes)<- as.factor(colnames(Nodes))

network1 = graph_from_adjacency_matrix(matrix,mode="directed",weighted=T,diag=T)
#Generating a graph network structure - overall flow - directed with weights and diag different from zero

Links1 <- get.data.frame(network1)
#Getting a dataframe from igraph object (from, to, weight) - overall flow

Links1$logweight <- log(Links1$weight)
#Creating a transformed variable using log weight

#Generating first sankey plot object
sankeyNetwork(Links= Links1, Nodes = Nodes, Source = 'from', 
              Target = 'to', Value = 'weight', fontSize=12, nodeWidth=30)


sankeyNetwork(Links= Links1, Source = 'from', Target = 'to', Nodes = as.data.frame(Links1$from),
              Value = 'weight')
